# Wallet - é’±åŒ…åŠŸèƒ½æ¨¡å—

**ç‰ˆæœ¬**: 1.0.0-alpha  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-11-17

---

## ğŸ“‹ æ¦‚è¿°

Wallet æ¨¡å—æä¾›å¯†é’¥ç®¡ç†ã€äº¤æ˜“ç­¾åç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚æ‰€æœ‰ä¸šåŠ¡æœåŠ¡éƒ½é€šè¿‡ Wallet æ¥å£è¿›è¡Œç­¾åï¼Œç¡®ä¿ç§é’¥ä¸ç¦»å¼€é’±åŒ…ï¼Œç¬¦åˆå®‰å…¨æœ€ä½³å®è·µã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ¨¡å—æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Wallet æ¨¡å—æ¶æ„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wallet æ¥å£     â”‚  (wallet.Wallet)
â”‚                  â”‚
â”‚  â€¢ Address()     â”‚
â”‚  â€¢ SignTransaction() â”‚
â”‚  â€¢ SignMessage() â”‚
â”‚  â€¢ PrivateKey()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘
        â”‚ å®ç°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SimpleWallet    â”‚      â”‚  KeystoreManager â”‚
â”‚                  â”‚      â”‚                  â”‚
â”‚  â€¢ å†…å­˜å­˜å‚¨      â”‚      â”‚  â€¢ åŠ å¯†å­˜å‚¨      â”‚
â”‚  â€¢ å¼€å‘/æµ‹è¯•ç”¨   â”‚      â”‚  â€¢ PBKDF2        â”‚
â”‚                  â”‚      â”‚  â€¢ AES-256-GCM   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                          â†‘
        â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§é’¥ç®¡ç†        â”‚      â”‚  æ–‡ä»¶å­˜å‚¨        â”‚
â”‚                  â”‚      â”‚                  â”‚
â”‚  â€¢ ECDSA         â”‚      â”‚  â€¢ JSON æ ¼å¼     â”‚
â”‚  â€¢ secp256k1     â”‚      â”‚  â€¢ åŠ å¯†ç§é’¥      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Wallet åœ¨äº¤æ˜“æµç¨‹ä¸­çš„ä½ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Wallet åœ¨äº¤æ˜“æµç¨‹ä¸­çš„ä½œç”¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸šåŠ¡æœåŠ¡å±‚
  â”‚
  â”œâ”€> æ„å»ºæœªç­¾åäº¤æ˜“
  â”‚   â””â”€> unsignedTxBytes
  â”‚
  â†“
Wallet å±‚ (wallet/)
  â”‚
  â”œâ”€> wallet.SignTransaction(unsignedTxBytes)
  â”‚   â”‚
  â”‚   â”œâ”€> 1. è§£æäº¤æ˜“
  â”‚   â”œâ”€> 2. è®¡ç®—äº¤æ˜“å“ˆå¸Œ
  â”‚   â”œâ”€> 3. ECDSA ç­¾å
  â”‚   â””â”€> 4. åºåˆ—åŒ–ç­¾å
  â”‚
  â†“
å·²ç­¾åäº¤æ˜“
  â”‚
  â””â”€> signedTxBytes â†’ "0x..." (hex)
      â”‚
      â†“
å®¢æˆ·ç«¯å±‚
  â”‚
  â””â”€> client.SendRawTransaction(signedTxHex)
      â”‚
      â†“
èŠ‚ç‚¹ API
```

### å¯†é’¥æ´¾ç”Ÿæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åœ°å€æ´¾ç”Ÿæµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç§é’¥ (32 bytes)
  â”‚
  â”œâ”€> [å½“å‰å®ç°] ä½¿ç”¨ç§é’¥ D å€¼çš„å‰ 20 å­—èŠ‚
  â”‚
  â””â”€> [æ ‡å‡†å®ç°] (æœªæ¥)
      â”‚
      â”œâ”€> 1. ä»ç§é’¥å¯¼å‡ºå…¬é’¥ (secp256k1)
      â”œâ”€> 2. SHA256(å…¬é’¥)
      â”œâ”€> 3. RIPEMD160(SHA256(å…¬é’¥))
      â”œâ”€> 4. æ·»åŠ ç‰ˆæœ¬å­—èŠ‚
      â”œâ”€> 5. è®¡ç®—æ ¡éªŒå’Œ
      â””â”€> 6. Base58Check ç¼–ç 
          â”‚
          â””â”€> WES åœ°å€ (Base58)
```

---

## ğŸ”‘ æ ¸å¿ƒæ¥å£

### Wallet æ¥å£

```go
type Wallet interface {
    // Address è¿”å›é’±åŒ…åœ°å€ï¼ˆ20 å­—èŠ‚ï¼‰
    Address() []byte
    
    // SignTransaction ç­¾åäº¤æ˜“
    SignTransaction(tx []byte) ([]byte, error)
    
    // SignMessage ç­¾åæ¶ˆæ¯
    SignMessage(msg []byte) ([]byte, error)
    
    // SignHash ç­¾åå“ˆå¸Œå€¼
    SignHash(hash []byte) ([]byte, error)
    
    // PrivateKey è¿”å›ç§é’¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
    PrivateKey() *ecdsa.PrivateKey
}
```

### å®ç°ç±»å‹

#### SimpleWallet

**ç”¨é€”**: å¼€å‘ã€æµ‹è¯•ã€ç®€å•åº”ç”¨

**ç‰¹ç‚¹**:
- âœ… å†…å­˜å­˜å‚¨ç§é’¥
- âœ… å¿«é€Ÿåˆ›å»ºå’Œä½¿ç”¨
- âœ… æ”¯æŒä»ç§é’¥åˆ›å»º
- âš ï¸ **ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ**

**ä½¿ç”¨åœºæ™¯**:
```
å¼€å‘ç¯å¢ƒ
  â”œâ”€> å¿«é€Ÿæµ‹è¯•
  â”œâ”€> ç¤ºä¾‹ä»£ç 
  â””â”€> åŸå‹å¼€å‘
```

#### KeystoreManager

**ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒã€æŒä¹…åŒ–å­˜å‚¨

**ç‰¹ç‚¹**:
- âœ… åŠ å¯†å­˜å‚¨ç§é’¥
- âœ… PBKDF2 å¯†é’¥æ´¾ç”Ÿ
- âœ… AES-256-GCM åŠ å¯†
- âœ… JSON æ ¼å¼å­˜å‚¨

**ä½¿ç”¨åœºæ™¯**:
```
ç”Ÿäº§ç¯å¢ƒ
  â”œâ”€> åº”ç”¨é’±åŒ…
  â”œâ”€> æœåŠ¡ç«¯åº”ç”¨
  â””â”€> éœ€è¦æŒä¹…åŒ–çš„åœºæ™¯
```

---

## ğŸ”§ ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºé’±åŒ…

#### æ–¹å¼1: åˆ›å»ºæ–°é’±åŒ…

```go
wallet, err := wallet.NewWallet()
if err != nil {
    log.Fatal(err)
}

address := wallet.Address()
fmt.Printf("æ–°é’±åŒ…åœ°å€: %x\n", address)
```

#### æ–¹å¼2: ä»ç§é’¥åˆ›å»º

```go
// ä»åå…­è¿›åˆ¶ç§é’¥åˆ›å»º
privateKeyHex := "0x1234567890abcdef..."
wallet, err := wallet.NewWalletFromPrivateKey(privateKeyHex)
if err != nil {
    log.Fatal(err)
}

address := wallet.Address()
fmt.Printf("é’±åŒ…åœ°å€: %x\n", address)
```

#### æ–¹å¼3: ä» Keystore åŠ è½½

```go
keystore := wallet.NewKeystoreManager("/path/to/keystore")

// åŠ è½½é’±åŒ…
wallet, err := keystore.LoadWallet("wallet.json", "password")
if err != nil {
    log.Fatal(err)
}
```

### 2. ç­¾åäº¤æ˜“

```go
// 1. è·å–æœªç­¾åäº¤æ˜“ï¼ˆä»ä¸šåŠ¡æœåŠ¡ï¼‰
unsignedTxBytes := []byte{...} // ä» buildTransaction è·å–

// 2. ä½¿ç”¨ Wallet ç­¾å
signedTxBytes, err := wallet.SignTransaction(unsignedTxBytes)
if err != nil {
    log.Fatal(err)
}

// 3. è½¬æ¢ä¸ºåå…­è¿›åˆ¶
signedTxHex := "0x" + hex.EncodeToString(signedTxBytes)

// 4. æäº¤äº¤æ˜“
result, err := client.SendRawTransaction(ctx, signedTxHex)
```

### 3. ç­¾åæ¶ˆæ¯

```go
message := []byte("Hello, WES!")

signature, err := wallet.SignMessage(message)
if err != nil {
    log.Fatal(err)
}

fmt.Printf("ç­¾å: %x\n", signature)
```

### 4. åœ¨ä¸šåŠ¡æœåŠ¡ä¸­ä½¿ç”¨

```go
// æ–¹å¼1: æ–¹æ³•å‚æ•°ä¼ é€’ï¼ˆæ¨èï¼‰
tokenService := token.NewService(client)
result, err := tokenService.Transfer(ctx, &token.TransferRequest{
    From:   wallet.Address(),
    To:     toAddr,
    Amount: 1000,
}, wallet) // ä¼ å…¥ wallet

// æ–¹å¼2: æ„é€ å‡½æ•°è®¾ç½®é»˜è®¤ wallet
tokenService := token.NewServiceWithWallet(client, wallet)
result, err := tokenService.Transfer(ctx, &token.TransferRequest{
    From:   wallet.Address(),
    To:     toAddr,
    Amount: 1000,
}) // ä½¿ç”¨é»˜è®¤ wallet
```

---

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. ç§é’¥ç®¡ç†ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç§é’¥ç®¡ç†ç­–ç•¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¼€å‘ç¯å¢ƒ:
  SimpleWallet
    â”œâ”€> å†…å­˜å­˜å‚¨
    â”œâ”€> å¿«é€Ÿåˆ›å»º
    â””â”€> âš ï¸ ä¸æŒä¹…åŒ–

ç”Ÿäº§ç¯å¢ƒ:
  KeystoreManager
    â”œâ”€> åŠ å¯†å­˜å‚¨
    â”œâ”€> å¯†ç ä¿æŠ¤
    â””â”€> âœ… å®‰å…¨æŒä¹…åŒ–

ç¡¬ä»¶é’±åŒ… (æœªæ¥):
  HardwareWallet
    â”œâ”€> ç§é’¥ä¸ç¦»å¼€è®¾å¤‡
    â”œâ”€> ç¡¬ä»¶ç­¾å
    â””â”€> âœ… æœ€é«˜å®‰å…¨æ€§
```

### 2. ç­¾åå®‰å…¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ç­¾åå®‰å…¨æµç¨‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. äº¤æ˜“æ„å»º (SDK å±‚)
   â””â”€> ä¸åŒ…å«ç§é’¥ä¿¡æ¯

2. Wallet ç­¾å (å®¢æˆ·ç«¯)
   â””â”€> ç§é’¥ä¸ç¦»å¼€é’±åŒ…

3. æäº¤äº¤æ˜“ (API)
   â””â”€> åªä¼ è¾“å·²ç­¾åäº¤æ˜“

4. èŠ‚ç‚¹éªŒè¯
   â””â”€> éªŒè¯ç­¾åæœ‰æ•ˆæ€§
```

### 3. Keystore åŠ å¯†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Keystore åŠ å¯†æµç¨‹                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç§é’¥ (32 bytes)
    â†“
PBKDF2 (å¯†ç  + Salt)
    â†“
æ´¾ç”Ÿå¯†é’¥ (32 bytes)
    â†“
AES-256-GCM åŠ å¯†
    â†“
åŠ å¯†ç§é’¥ + IV + Tag
    â†“
JSON æ ¼å¼å­˜å‚¨
    {
      "crypto": {
        "cipher": "aes-256-gcm",
        "kdf": "pbkdf2",
        ...
      }
    }
```

---

## ğŸ“Š å®ç°çŠ¶æ€

### SimpleWallet âœ…

- âœ… é’±åŒ…åˆ›å»º
- âœ… ä»ç§é’¥åˆ›å»º
- âœ… äº¤æ˜“ç­¾å
- âœ… æ¶ˆæ¯ç­¾å
- âœ… åœ°å€æ´¾ç”Ÿï¼ˆç®€åŒ–ç‰ˆï¼‰
- âš ï¸ åœ°å€æ´¾ç”Ÿéœ€è¦å®Œå–„ï¼ˆå½“å‰ä½¿ç”¨ç§é’¥ D å€¼ï¼‰

### KeystoreManager âœ…

- âœ… Keystore åˆ›å»º
- âœ… é’±åŒ…ä¿å­˜
- âœ… é’±åŒ…åŠ è½½
- âœ… PBKDF2 å¯†é’¥æ´¾ç”Ÿ
- âœ… AES-256-GCM åŠ å¯†
- âœ… JSON æ ¼å¼å­˜å‚¨

---

## ğŸš€ æœªæ¥æ”¹è¿›

### 1. å®Œå–„åœ°å€æ´¾ç”Ÿ

```
å½“å‰: ä½¿ç”¨ç§é’¥ D å€¼çš„å‰ 20 å­—èŠ‚ï¼ˆç®€åŒ–ï¼‰

æœªæ¥: æ ‡å‡†åœ°å€æ´¾ç”Ÿ
  â”œâ”€> secp256k1 å…¬é’¥å¯¼å‡º
  â”œâ”€> SHA256 + RIPEMD160
  â”œâ”€> Base58Check ç¼–ç 
  â””â”€> WES æ ‡å‡†åœ°å€æ ¼å¼
```

### 2. æ”¯æŒæ›´å¤šé’±åŒ…ç±»å‹

- [ ] HD é’±åŒ…ï¼ˆBIP39 åŠ©è®°è¯ï¼‰
- [ ] ç¡¬ä»¶é’±åŒ…æ¥å£
- [ ] å¤šç­¾åé’±åŒ…

### 3. å¢å¼ºå®‰å…¨æ€§

- [ ] ç¡¬ä»¶å®‰å…¨æ¨¡å— (HSM) æ”¯æŒ
- [ ] å¯†é’¥åˆ†ç‰‡å­˜å‚¨
- [ ] ç­¾åå®¡è®¡æ—¥å¿—

---

## ğŸ“š API å‚è€ƒ

### Wallet æ¥å£

```go
type Wallet interface {
    // Address è¿”å›é’±åŒ…åœ°å€ï¼ˆ20 å­—èŠ‚ï¼‰
    Address() []byte
    
    // SignTransaction ç­¾åäº¤æ˜“
    // å‚æ•°: æœªç­¾åäº¤æ˜“ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰
    // è¿”å›: å·²ç­¾åäº¤æ˜“ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰
    SignTransaction(tx []byte) ([]byte, error)
    
    // SignMessage ç­¾åæ¶ˆæ¯
    // å‚æ•°: æ¶ˆæ¯ï¼ˆå­—èŠ‚æ•°ç»„ï¼‰
    // è¿”å›: ç­¾åï¼ˆå­—èŠ‚æ•°ç»„ï¼Œr||s æ ¼å¼ï¼Œ64 å­—èŠ‚ï¼‰
    SignMessage(msg []byte) ([]byte, error)
    
    // SignHash ç­¾åå“ˆå¸Œå€¼
    // å‚æ•°: å“ˆå¸Œå€¼ï¼ˆ32 å­—èŠ‚ï¼‰
    // è¿”å›: ç­¾åï¼ˆå­—èŠ‚æ•°ç»„ï¼Œr||s æ ¼å¼ï¼Œ64 å­—èŠ‚ï¼‰
    SignHash(hash []byte) ([]byte, error)
    
    // PrivateKey è¿”å›ç§é’¥ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
    // âš ï¸ ä»…ç”¨äºé«˜çº§åœºæ™¯ï¼Œç”Ÿäº§ç¯å¢ƒåº”é¿å…ä½¿ç”¨
    PrivateKey() *ecdsa.PrivateKey
}
```

### æ„é€ å‡½æ•°

```go
// NewWallet åˆ›å»ºæ–°é’±åŒ…
func NewWallet() (Wallet, error)

// NewWalletFromPrivateKey ä»ç§é’¥åˆ›å»ºé’±åŒ…
func NewWalletFromPrivateKey(privateKeyHex string) (Wallet, error)

// NewKeystoreManager åˆ›å»º Keystore ç®¡ç†å™¨
func NewKeystoreManager(keystoreDir string) *KeystoreManager
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [ä¸» README](../README.md) - SDK æ€»ä½“æ–‡æ¡£
- [Services æ–‡æ¡£](../services/README.md) - ä¸šåŠ¡æœåŠ¡æ–‡æ¡£
- [æ¶æ„è®¾è®¡æ–‡æ¡£](../../SDK_DESIGN.md) - SDK è®¾è®¡æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2025-11-17  
**ç»´æŠ¤è€…**: WES Core Team
