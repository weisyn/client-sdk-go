# Utils - å·¥å…·å‡½æ•°æ¨¡å—

**ç‰ˆæœ¬**: 1.0.0-alpha  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ  
**æœ€åæ›´æ–°**: 2025-11-17

---

## ğŸ“‹ æ¦‚è¿°

Utils æ¨¡å—æä¾› SDK å†…éƒ¨ä½¿ç”¨çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬åœ°å€è½¬æ¢ã€ç¼–ç è§£ç ç­‰è¾…åŠ©åŠŸèƒ½ã€‚æ‰€æœ‰å·¥å…·å‡½æ•°éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–ä»»ä½• WES å†…éƒ¨åŒ…ã€‚

---

## ğŸ—ï¸ æ¨¡å—æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Utils æ¨¡å—æ¶æ„                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

utils/
  â”‚
  â””â”€> address.go
      â”‚
      â”œâ”€> AddressBytesToBase58()      âœ…
      â”œâ”€> AddressBase58ToBytes()     âœ…
      â”œâ”€> AddressHexToBase58()        âœ…
      â””â”€> AddressBase58ToHex()        âœ…
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### åœ°å€è½¬æ¢

#### Base58Check ç¼–ç æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      WES åœ°å€æ ¼å¼ (Base58Check)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®Œæ•´åœ°å€ç»“æ„:
  [ç‰ˆæœ¬å­—èŠ‚(1)] + [åœ°å€å“ˆå¸Œ(20)] + [æ ¡éªŒå’Œ(4)] = 25 å­—èŠ‚
       â†“              â†“              â†“
     Base58Check ç¼–ç 
       â†“
  WES åœ°å€å­—ç¬¦ä¸² (Base58)
```

**ç‰ˆæœ¬å­—èŠ‚**: `0x1C` (WESP2PKHVersion)

**æ ¡éªŒå’Œ**: åŒé‡ SHA256 çš„å‰ 4 å­—èŠ‚

#### åœ°å€è½¬æ¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åœ°å€è½¬æ¢æµç¨‹                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

20 å­—èŠ‚åœ°å€å“ˆå¸Œ
    â†“
æ·»åŠ ç‰ˆæœ¬å­—èŠ‚ (0x1C)
    â†“
è®¡ç®—æ ¡éªŒå’Œ (SHA256(SHA256(versioned)))
    â†“
Base58 ç¼–ç 
    â†“
WES åœ°å€ (Base58)
```

---

## ğŸ“– API å‚è€ƒ

### AddressBytesToBase58

å°† 20 å­—èŠ‚åœ°å€è½¬æ¢ä¸º Base58Check ç¼–ç ã€‚

```go
func AddressBytesToBase58(addressBytes []byte) (string, error)
```

**å‚æ•°**:
- `addressBytes`: 20 å­—èŠ‚åœ°å€å“ˆå¸Œ

**è¿”å›**:
- `string`: Base58Check ç¼–ç çš„åœ°å€
- `error`: é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹**:
```go
addressBytes := []byte{0x12, 0x34, ...} // 20 å­—èŠ‚
base58Addr, err := utils.AddressBytesToBase58(addressBytes)
if err != nil {
    log.Fatal(err)
}
fmt.Printf("åœ°å€: %s\n", base58Addr) // è¾“å‡º: CUQ3g6P5WmFN289pPn7AAhnQ3T2cZRv2BR
```

### AddressBase58ToBytes

å°† Base58Check ç¼–ç åœ°å€è½¬æ¢ä¸º 20 å­—èŠ‚åœ°å€å“ˆå¸Œã€‚

```go
func AddressBase58ToBytes(base58Addr string) ([]byte, error)
```

**å‚æ•°**:
- `base58Addr`: Base58Check ç¼–ç çš„åœ°å€

**è¿”å›**:
- `[]byte`: 20 å­—èŠ‚åœ°å€å“ˆå¸Œ
- `error`: é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹**:
```go
base58Addr := "CUQ3g6P5WmFN289pPn7AAhnQ3T2cZRv2BR"
addressBytes, err := utils.AddressBase58ToBytes(base58Addr)
if err != nil {
    log.Fatal(err)
}
fmt.Printf("åœ°å€å­—èŠ‚: %x\n", addressBytes) // è¾“å‡º: 1234...
```

### AddressHexToBase58

å°†åå…­è¿›åˆ¶åœ°å€å­—ç¬¦ä¸²è½¬æ¢ä¸º Base58Check ç¼–ç ã€‚

```go
func AddressHexToBase58(hexAddr string) (string, error)
```

**å‚æ•°**:
- `hexAddr`: åå…­è¿›åˆ¶åœ°å€å­—ç¬¦ä¸²ï¼ˆå¯å¸¦æˆ–ä¸å¸¦ `0x` å‰ç¼€ï¼‰

**è¿”å›**:
- `string`: Base58Check ç¼–ç çš„åœ°å€
- `error`: é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹**:
```go
hexAddr := "0x1234567890abcdef1234567890abcdef12345678"
base58Addr, err := utils.AddressHexToBase58(hexAddr)
```

### AddressBase58ToHex

å°† Base58Check ç¼–ç åœ°å€è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚

```go
func AddressBase58ToHex(base58Addr string) (string, error)
```

**å‚æ•°**:
- `base58Addr`: Base58Check ç¼–ç çš„åœ°å€

**è¿”å›**:
- `string`: åå…­è¿›åˆ¶åœ°å€å­—ç¬¦ä¸²ï¼ˆä¸å¸¦ `0x` å‰ç¼€ï¼‰
- `error`: é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹**:
```go
base58Addr := "CUQ3g6P5WmFN289pPn7AAhnQ3T2cZRv2BR"
hexAddr, err := utils.AddressBase58ToHex(base58Addr)
// è¾“å‡º: 1234567890abcdef1234567890abcdef12345678
```

---

## ğŸ”’ å®ç°ç»†èŠ‚

### Base58Check ç¼–ç ç®—æ³•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Base58Check ç¼–ç ç®—æ³•                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. æ„å»ºè½½è·
   [ç‰ˆæœ¬å­—èŠ‚(0x1C)] + [åœ°å€å“ˆå¸Œ(20å­—èŠ‚)]

2. è®¡ç®—æ ¡éªŒå’Œ
   checksum = SHA256(SHA256(payload))[:4]

3. æ„å»ºå®Œæ•´æ•°æ®
   [è½½è·] + [æ ¡éªŒå’Œ(4å­—èŠ‚)] = 25 å­—èŠ‚

4. Base58 ç¼–ç 
   ä½¿ç”¨ btcutil/base58 åº“ç¼–ç 
```

### æ ¡éªŒå’ŒéªŒè¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ ¡éªŒå’ŒéªŒè¯æµç¨‹                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Base58 è§£ç 
    â†“
åˆ†ç¦»è½½è·å’Œæ ¡éªŒå’Œ
    â†“
è®¡ç®—æœŸæœ›æ ¡éªŒå’Œ
    SHA256(SHA256(payload))[:4]
    â†“
æ¯”è¾ƒæ ¡éªŒå’Œ
    â†“
éªŒè¯é€šè¿‡/å¤±è´¥
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. æŸ¥è¯¢ UTXO

```go
// å°†å­—èŠ‚åœ°å€è½¬æ¢ä¸º Base58ï¼ˆwes_getUTXO éœ€è¦ Base58 åœ°å€ï¼‰
fromAddrBytes := wallet.Address()
fromAddrBase58, err := utils.AddressBytesToBase58(fromAddrBytes)
if err != nil {
    return err
}

// è°ƒç”¨ API
result, err := client.Call(ctx, "wes_getUTXO", []interface{}{fromAddrBase58})
```

### 2. åœ°å€æ ¼å¼è½¬æ¢

```go
// ä»åå…­è¿›åˆ¶è½¬æ¢ä¸º Base58
hexAddr := "0x1234567890abcdef1234567890abcdef12345678"
base58Addr, _ := utils.AddressHexToBase58(hexAddr)

// ä» Base58 è½¬æ¢ä¸ºåå…­è¿›åˆ¶
hexAddr, _ := utils.AddressBase58ToHex(base58Addr)
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. åœ°å€é•¿åº¦

- âœ… è¾“å…¥åœ°å€å¿…é¡»æ˜¯ **20 å­—èŠ‚**
- âœ… Base58Check ç¼–ç åé•¿åº¦ä¸º **25 å­—èŠ‚**ï¼ˆç¼–ç å‰ï¼‰
- âœ… Base58 å­—ç¬¦ä¸²é•¿åº¦çº¦ä¸º **34 å­—ç¬¦**

### 2. ç‰ˆæœ¬å­—èŠ‚

- âœ… WES ä½¿ç”¨ç‰ˆæœ¬å­—èŠ‚ `0x1C` (WESP2PKHVersion)
- âœ… ä¸ Bitcoin ä¸»ç½‘ç‰ˆæœ¬ (`0x00`) ä¸åŒ
- âœ… ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬å­—èŠ‚

### 3. é”™è¯¯å¤„ç†

æ‰€æœ‰å‡½æ•°éƒ½ä¼šè¿›è¡Œä¸¥æ ¼çš„å‚æ•°éªŒè¯ï¼š

```go
// åœ°å€é•¿åº¦éªŒè¯
if len(addressBytes) != 20 {
    return "", fmt.Errorf("invalid address length: expected 20 bytes, got %d", len(addressBytes))
}

// æ ¡éªŒå’ŒéªŒè¯
if !equalBytes(checksum, expectedChecksum) {
    return nil, fmt.Errorf("invalid checksum")
}
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸» README](../README.md) - SDK æ€»ä½“æ–‡æ¡£
- [Client æ–‡æ¡£](../client/README.md) - å®¢æˆ·ç«¯æ–‡æ¡£

---

**æœ€åæ›´æ–°**: 2025-11-17  
**ç»´æŠ¤è€…**: WES Core Team

